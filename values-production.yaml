# ============================================
# STACKBILL HELM CHART - PRODUCTION VALUES
# ============================================
# High-availability configuration for production
# Use: helm install stackbill . -f values-production.yaml
# ============================================

global:
  environment: production
  storageClass: "fast-ssd"

# Production StackBill configuration
stackbill:
  replicaCount: 3

  resources:
    requests:
      cpu: "1000m"
      memory: "2Gi"
    limits:
      cpu: "4000m"
      memory: "8Gi"

  config:
    logLevel: INFO
    debug: false

  # Pod anti-affinity for HA
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - stackbill
            topologyKey: kubernetes.io/hostname

# Production ingress with TLS
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: portal.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    enabled: true
    secretName: stackbill-tls
    hosts:
      - portal.yourdomain.com

# Enable Istio for production
istio:
  enabled: true
  virtualService:
    timeout: 60s
    retries:
      attempts: 3

# Production MySQL
mysql:
  enabled: true
  architecture: replication
  primary:
    persistence:
      enabled: true
      size: 100Gi
      storageClass: "fast-ssd"
    resources:
      requests:
        cpu: "1000m"
        memory: "2Gi"
      limits:
        cpu: "2000m"
        memory: "4Gi"
  secondary:
    replicaCount: 1
    persistence:
      enabled: true
      size: 100Gi

# Production MongoDB
mongodb:
  enabled: true
  architecture: replicaset
  replicaCount: 3
  persistence:
    enabled: true
    size: 100Gi
    storageClass: "fast-ssd"
  resources:
    requests:
      cpu: "1000m"
      memory: "2Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"

# Production RabbitMQ
rabbitmq:
  enabled: true
  replicaCount: 3
  persistence:
    enabled: true
    size: 20Gi
    storageClass: "fast-ssd"
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "1000m"
      memory: "2Gi"

# Production storage
persistence:
  enabled: true
  size: 500Gi
  storageClass: "fast-ssd"
  accessMode: ReadWriteMany

# Enable autoscaling
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Enable PDB
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Enable monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 15s
  grafana:
    enabled: true
    dashboards: true

# Production security
security:
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  networkPolicy:
    enabled: true

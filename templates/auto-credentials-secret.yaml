{{- if eq .Values.global.mode "poc" }}
# Auto-generated credentials for POC deployment
# Supports both in-cluster (Bitnami) and external database modes
apiVersion: v1
kind: Secret
metadata:
  name: stackbill-auto-credentials
  namespace: {{ .Values.global.namespace }}
  labels:
    app.kubernetes.io/name: stackbill
    app.kubernetes.io/component: credentials
    app.kubernetes.io/mode: poc
type: Opaque
stringData:
  {{- if .Values.mysql.enabled }}
  # MySQL Credentials (In-Cluster)
  MYSQL_HOST: "{{ .Release.Name }}-mysql"
  MYSQL_PORT: "3306"
  MYSQL_DATABASE: "{{ .Values.mysql.auth.database }}"
  MYSQL_USERNAME: "{{ .Values.mysql.auth.username }}"
  MYSQL_PASSWORD: "{{ .Values.mysql.auth.password | default (randAlphaNum 16) }}"
  MYSQL_ROOT_PASSWORD: "{{ .Values.mysql.auth.rootPassword | default (randAlphaNum 16) }}"
  {{- else if .Values.external.mysql.host }}
  # MySQL Credentials (External)
  MYSQL_HOST: "{{ .Values.external.mysql.host }}"
  MYSQL_PORT: "{{ .Values.external.mysql.port | default 3306 }}"
  MYSQL_DATABASE: "{{ .Values.external.mysql.database | default "stackbill" }}"
  MYSQL_USERNAME: "{{ .Values.external.mysql.username | default "stackbill" }}"
  MYSQL_PASSWORD: "{{ .Values.external.mysql.password }}"
  {{- end }}

  {{- if .Values.mongodb.enabled }}
  # MongoDB Credentials (In-Cluster)
  MONGODB_HOST: "{{ .Release.Name }}-mongodb"
  MONGODB_PORT: "27017"
  MONGODB_DATABASE: "{{ .Values.mongodb.auth.database }}"
  MONGODB_USERNAME: "{{ .Values.mongodb.auth.username }}"
  MONGODB_PASSWORD: "{{ .Values.mongodb.auth.password | default (randAlphaNum 16) }}"
  {{- else if .Values.external.mongodb.host }}
  # MongoDB Credentials (External)
  MONGODB_HOST: "{{ .Values.external.mongodb.host }}"
  MONGODB_PORT: "{{ .Values.external.mongodb.port | default 27017 }}"
  MONGODB_DATABASE: "{{ .Values.external.mongodb.database | default "stackbill_usage" }}"
  MONGODB_USERNAME: "{{ .Values.external.mongodb.username | default "stackbill" }}"
  MONGODB_PASSWORD: "{{ .Values.external.mongodb.password }}"
  {{- end }}

  {{- if .Values.rabbitmq.enabled }}
  # RabbitMQ Credentials (In-Cluster)
  RABBITMQ_HOST: "{{ .Release.Name }}-rabbitmq"
  RABBITMQ_PORT: "5672"
  RABBITMQ_USERNAME: "{{ .Values.rabbitmq.auth.username }}"
  RABBITMQ_PASSWORD: "{{ .Values.rabbitmq.auth.password | default (randAlphaNum 16) }}"
  RABBITMQ_VHOST: "/"
  {{- else if .Values.external.rabbitmq.host }}
  # RabbitMQ Credentials (External)
  RABBITMQ_HOST: "{{ .Values.external.rabbitmq.host }}"
  RABBITMQ_PORT: "{{ .Values.external.rabbitmq.port | default 5672 }}"
  RABBITMQ_USERNAME: "{{ .Values.external.rabbitmq.username | default "stackbill" }}"
  RABBITMQ_PASSWORD: "{{ .Values.external.rabbitmq.password }}"
  RABBITMQ_VHOST: "/"
  {{- end }}

  {{- if .Values.external.nfs.server }}
  # NFS Configuration (External)
  NFS_SERVER: "{{ .Values.external.nfs.server }}"
  NFS_PATH: "{{ .Values.external.nfs.path | default "/data/stackbill" }}"
  {{- else }}
  # NFS Configuration (Default)
  NFS_SERVER: "{{ .Release.Name }}-nfs"
  NFS_PATH: "{{ .Values.nfs.storage.path }}"
  {{- end }}

  # Domain Configuration
  DOMAIN_NAME: "{{ .Values.domain.name }}"
{{- end }}
